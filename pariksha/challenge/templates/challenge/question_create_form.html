{% extends "challenge/base.html" %} {% block content %} {% load crispy_forms_tags %} {% load static %}
<style>
    .pretty.p-switch .state:before {
        height: 1rem;
    }
</style>
{% if user.is_authenticated %}
<div class="model_form_outer_wrapper">
    <div class="header_wrapper">
        <div class="model_form_title">
            <h1>Create {{model_name}}</h1>
            <p class="Description_para">Host this contest on pariksha and allow users to take the test.</p>
            <p class="Description_para italic">Get started by providing the initial details for your contest.</p>
        </div>
        <div class="header_description"></div>
    </div>
    <form method="POST" id="form">
        {% csrf_token %}
        <div class="model_form_main_wrapper">
            <section class="model_form_section">

                <div class="label_field_wrapper">
                    <label for="{{form.Title.name}}">Title</label> {{form.Title}}
                </div>
                <p id="question_title_error" class="form_error"><strong></strong></p>


                <div class="label_field_wrapper">
                    <label for="{{form.Slug.name}}">Slug</label> {{form.Slug}}
                </div>
                <p id="question_slug_error" class="form_error"><strong></strong></p>

                <div class="label_field_wrapper">
                    <label for="{{form.Type.name}}">Type</label> {{form.Type}}
                </div>
                <p id="question_type_error" class="form_error"><strong></strong></p>

                <div class="label_field_wrapper">
                    <label for="{{form.Description.name}}">Description</label> {{form.Description}}
                </div>
                <p id="question_description_error" class="form_error"><strong></strong></p>

                <div class="label_field_wrapper">
                    <label for="{{form.default_c_code.name}}">Default C code</label> {{form.default_c_code}}
                </div>
                <p id="default_c_code" class="form_error"><strong></strong></p>

                <div class="label_field_wrapper">
                    <label for="{{form.default_cpp_code.name}}">Default C++ code</label> {{form.default_cpp_code}}
                </div>
                <p id="default_cpp_code" class="form_error"><strong></strong></p>

                <div class="label_field_wrapper">
                    <label for="{{form.default_java_code.name}}">Default Java code</label> {{form.default_java_code}}
                </div>
                <p id="default_java_code" class="form_error"><strong></strong></p>

                <div class="label_field_wrapper">
                    <label for="{{form.default_csharp_code.name}}">Default C# code</label> {{form.default_csharp_code}}
                </div>
                <p id="default_csharp_code" class="form_error"><strong></strong></p>

                <div class="label_field_wrapper">
                    <label for="{{form.default_python_code.name}}">Default Python code</label> {{form.default_python_code}}
                </div>
                {% if form.default_python_code.errors %} {% for error in form.default_python_code.errors %}
                <p class="form_error"><strong>{{ error|escape }}</strong></p>
                {% endfor %} {% endif %}
                <p id="default_python_code" class="form_error"><strong></strong></p>



                <div class="footer_form_button floater_right">
                    <a id="question_edit_link" href="">
                        <button type="button" id="question_edit_link" onclick="window.location.href = 'https://w3docs.com';" class="positive_button">Edit</button>
                    </a>
                    <button id="save_btn" class="positive_button" onclick="formAsyncSave()" type="button">
                        Save
                    </button>
                </div>
            </section>
        </div>
    </form>
    <div class="qfooter_form_button">

    </div>
</div>


{% endif %} 


<script src="{% static 'challenge/scripts/jquery.popupoverlay.js' %}"></script>
<script src="{% static 'challenge/scripts/jquery.richtext.js' %}"></script>
<script src="{% static 'challenge/scripts/text_editor.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'challenge/content/question_model.css' %}" />

<script src="{% static 'challenge/scripts/question_creation.js' %}"></script>
<script>
var question_title,question_slug, question_type, question_description, q_default_c_code, q_default_cpp_code, q_default_csharp_code, q_default_java_code, q_default_python_code;

window.onload = function () {
            var edit_button_link = document.getElementById('question_edit_link');
            edit_button_link.style.display = "none";

        };
 title_error = document.getElementById('question_title_error');
 slug_error =  document.getElementById('question_slug_error');
 type_error =  document.getElementById('question_type_error');
 description_error =  document.getElementById('question_description_error');
 c_code_error =  document.getElementById('default_c_code');
 cpp_code_error =  document.getElementById('default_cpp_code');
 csharp_code_error =  document.getElementById('default_csharp_code');
 java_code_error =  document.getElementById('default_java_code');
 python_code_error =  document.getElementById('default_python_code');
console.log(c_editor.getValue());
 function formAsyncSave() {
      question_title = document.getElementById('id_Title');
 question_slug = document.getElementById('id_Slug');
 question_type = document.getElementById('id_Type');
 question_description = document.getElementById('q_description_editor');
 q_default_c_code= document.getElementById('id_default_c_code');
 q_default_cpp_code = document.getElementById('id_default_cpp_code');
 q_default_csharp_code = document.getElementById('id_default_csharp_code');
 q_default_java_code =document.getElementById('id_default_java_code') ;
 q_default_python_code = document.getElementById('id_default_python_code');
            $('#save_btn_loader').show();
            var save_button = document.getElementById('save_btn');
            save_button.innerText = 'Saving...';
            var ajaxMins = new Date().getMinutes();
            var ajaxSecs = new Date().getSeconds();
            var ajaxMS = new Date().getMilliseconds();
            $.ajax({

                type: 'POST',
                url: '',
                dataType: 'json',
                cache: false,
                async: true,
                data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                    question: 'yes',
                    Title: question_title.value,
                    Slug: question_slug.value,
                    Type: question_type.value,
                    Description:question_description.value,
                    default_c_code:c_editor.getValue(),
                    default_cpp_code:cpp_editor.getValue(),
                    default_csharp_code:csharp_editor.getValue(),
                    default_java_code:java_editor.getValue(),
                    default_python_code:python_editor.getValue(),
                
                },
                success: function (json) {
                    if (json.errors == 'yes') {
                        slug_error.innerText = '';
                        title_error.innerText = '';
                        type_error.innerText = '';
                        description_error.innerText = '';
                        c_code_error.innerText = '';
                        cpp_code_error.innerText = '';
                        csharp_code_error.innerText = '';
                        java_code_error.innerText = '';
                        python_code_error.innerText = '';

                        error_obj = json.form_errors;
                        var msg_err_map = {
                            'Slug': slug_error,
                            'Title': title_error,
                            'Type' : type_error,
                            'Description': description_error,
                            'default_c_code': c_code_error,
                            'default_cpp_code': cpp_code_error,
                            'default_csharp_code': csharp_code_error,
                            'default_java_code': java_code_error,
                            'default_python_code': python_code_error,
                        }
                        jQuery.each(error_obj, function (i, val) {
                            msg_err_map[i].innerText = val;
                        });
                        $("html, body").animate({ scrollTop: 0 }, "slow");
                        save_button.setAttribute('saved_status', 'unsaved');

                        save_button.textContent = "Save";
                        $('#save_btn_loader').hide();
                    }
                    else {
                     
                        title_error.innerText = '';
                        slug_error.innerText = '';
                        type_error.innerText = '';
                        description_error.innerText = '';
                        default_c_code.innerText = '';
                        default_cpp_code.innerText = '';
                        default_csharp_code.innerText = '';
                        default_java_code.innerText = '';
                        default_python_code.innerText = '';
                        
                        question_title.disabled = true;
                        question_slug.disabled = true;
                        question_description.disabled = true;
                        question_type.disabled = true;
                        python_editor.setOptions({
                            readOnly: true,
                            highlightActiveLine: false,
                            highlightGutterLine: false
                        })
                        python_editor.renderer.$cursorLayer.element.style.opacity=0
                        csharp_editor.setOptions({
                            readOnly: true,
                            highlightActiveLine: false,
                            highlightGutterLine: false
                        })
                        csharp_editor.renderer.$cursorLayer.element.style.opacity=0
                        java_editor.setOptions({
                            readOnly: true,
                            highlightActiveLine: false,
                            highlightGutterLine: false
                        })
                        java_editor.renderer.$cursorLayer.element.style.opacity=0
                        c_editor.setOptions({
                            readOnly: true,
                            highlightActiveLine: false,
                            highlightGutterLine: false
                        })
                        c_editor.renderer.$cursorLayer.element.style.opacity=0
                        cpp_editor.setOptions({
                            readOnly: true,
                            highlightActiveLine: false,
                            highlightGutterLine: false
                        })
                        cpp_editor.renderer.$cursorLayer.element.style.opacity=0
                        current_question_id = json.question_id;
                        save_button.textContent = "Saved";
                        save_button.disabled = true;
                        edit_contest_url = "/pariksha/modify/"+current_question_id+"/contest";
                        var edit_button_link1 = document.getElementById('question_edit_link');
                        edit_button_link1.style.display = "initial";
                        edit_button_link1.href = "{% url 'contest_edit_form' contest_id=12345 %}".replace(/12345/, current_question_id.toString());
                        section.setAttribute('data-collapsed', 'false')

                    }

                },

                statusCode: {
                    500: function () {
                    }
                },
            }).done(function () {
                var ajaxMins2 = new Date().getMinutes() - ajaxMins;
                var ajaxSecs2 = (new Date().getSeconds() % 60) - ajaxSecs;
                var ajaxMS2 = new Date().getMilliseconds() - ajaxMS;
                console.log(ajaxSecs2, " seconds");
                $('#save_btn_loader').hide();
            });

        }
</script>
{% endblock content %}